language: python
python:
  - '2.7'
env:
  - SALT_VERSION="2015.5.6"
  - SALT_VERSION="2015.8.0"
  - SALT_VERSION="2015.8.1"

install:
  - pip install salt==$SALT_VERSION
  - formula="users"
  - sudo mkdir /srv/salt; sudo cp -r $formula /srv/salt
  - sudo mkdir /var/{cache,log}/salt && sudo chown travis /var/{cache,log}/salt
  - states=$(find /srv/salt -name '*.sls' | while read i; do tmp=$formula.${i##*/}; echo ${tmp%.*}; done | xargs | sed -e 's/ /,/g')

  # See what kind of travis box you're on to help with making your states compatible with travis
  - salt-call grains.items --local

script:
  - salt-call state.show_sls --local --retcode-passthrough -l error test=True $states
